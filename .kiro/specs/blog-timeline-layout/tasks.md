# 博客时间线布局实现任务列表

## 任务概述

基于需求文档和设计文档，将博客时间线布局功能分解为具体的编码任务。遵循最小破坏性原则，完全复用现有组件，通过渐进式实现确保每个阶段都不破坏现有功能。

## 实现任务

- [x] 1. 创建时间线数据处理函数

  - 实现时间线数据处理的核心逻辑，为时间轴组件提供数据支持
  - _需求: 需求 0（YAML 时间读取 Bug 修复）、需求 1（时间线布局设计）、需求 2（时间组织和标识）、需求 4（性能优化功能）_

- [x] 1.1 创建时间线类型定义文件

  - 创建 `src/components/feature/blog/timeline/types.ts`
  - 定义 `TimelineData`、`YearData`、`TimelinePost` 接口
  - 使用组合模式避免与现有 `PostData` 类型冲突
  - _需求: 需求 0（YAML 时间读取 Bug 修复）、需求 1（时间线布局设计）_

- [x] 1.2 实现时间线数据生成函数

  - 创建 `src/lib/data/content/timeline.ts`
  - 实现 `generateTimelineData` 函数，处理文章时间排序和位置计算
  - 添加完整的边界情况处理（无效日期、单篇文章、零时间跨度）
  - 实现年份数据生成逻辑，确保年份标记位置准确
  - _需求: 需求 2（时间组织和标识）_

- [x] 1.3 实现颜色生成和缓存系统

  - 在 `timeline.ts` 中实现 `generateTimelineColor` 函数
  - 使用 Map 缓存颜色值，避免重复计算
  - 确保同一年份使用相同颜色，不同年份使用不同色系
  - 统一使用 HSL 格式颜色值
  - _需求: 需求 1（时间线布局设计）_

- [x] 1.4 实现数据缓存优化

  - 在 `timeline.ts` 中实现 `getTimelineDataForPosts` 函数
  - 使用 Map 缓存时间线数据，提高性能
  - 添加缓存大小限制，避免内存泄漏
  - 基于文章数量和最新文章日期创建缓存键
  - _需求: 需求 4（性能优化功能）_

- [x] 2. 创建时间轴组件

  - 实现左侧固定时间轴组件，显示年份标记和文章连接点
  - _需求: 需求 1（时间线布局设计）、需求 2（时间组织和标识）、需求 4（性能优化功能）_

- [x] 2.1 创建时间轴主组件文件

  - 创建 `src/components/feature/blog/timeline/TimelineAxis.tsx`
  - 实现基础组件结构和 props 接口
  - 集成现有的响应式 hooks（`useResponsive`）
  - 设置响应式配置（桌面 24px、平板 16px、移动端 12px 宽度）
  - _需求: 需求 1（时间线布局设计）_

- [x] 2.2 实现时间轴主线渲染

  - 使用 Tailwind 类名创建垂直渐变线条
  - 实现 `bg-gradient-to-b from-blue-500 via-purple-500 to-pink-500`
  - 确保线条居中显示，使用 `left-1/2 transform -translate-x-1/2`
  - _需求: 需求 1（时间线布局设计）_

- [x] 2.3 实现年份标记显示

  - 渲染年份标记，使用内联样式实现垂直文本
  - 添加 `writingMode: "vertical-rl"` 和 `textOrientation: "mixed"`
  - 在移动端隐藏年份标记以节省空间
  - 使用 Framer Motion 添加渐入动画
  - _需求: 需求 2（时间组织和标识）_

- [x] 2.4 实现文章连接节点

  - 渲染文章连接点，使用动态颜色和位置
  - 实现悬停缩放效果（桌面端 1.5 倍，移动端 1.2 倍）
  - 添加 Framer Motion 动画，限制延迟时间避免性能问题
  - 实现虚拟化渲染，限制同时显示的节点数量
  - _需求: 需求 2（时间组织和标识）、需求 4（性能优化功能）_

- [x] 2.5 创建组件导出文件

  - 创建 `src/components/feature/blog/timeline/index.ts`
  - 导出 `TimelineAxis` 组件和相关类型
  - _需求: 需求 1（时间线布局设计）_

- [x] 3. 修改博客页面集成时间轴

  - 在现有 BlogPageClient 中集成时间轴组件，保持所有现有功能不变
  - _需求: 需求 1（时间线布局设计）、需求 3（文章卡片展示）、需求 4（性能优化功能）_

- [x] 3.1 修改 BlogPageClient 导入

  - 在 `src/app/(public)/blog/BlogPageClient.tsx` 中添加时间线相关导入
  - 导入 `getTimelineDataForPosts` 和 `TimelineAxis`
  - 导入 `useResponsive` hook（如不存在则实现备用方案）
  - _需求: 需求 1（时间线布局设计）_

- [x] 3.2 添加时间线数据处理

  - 在 BlogPageClient 中使用 `useMemo` 处理时间线数据
  - 确保数据处理的稳定性，避免不必要的重计算
  - 添加类型定义以确保类型安全
  - _需求: 需求 4（性能优化功能）_

- [x] 3.3 集成响应式布局

  - 使用 `useResponsive` hook 获取设备类型
  - 实现响应式的内容区域边距（`ml-12`、`ml-16`、`ml-24`）
  - 确保在不同设备上的布局适配
  - _需求: 需求 1（时间线布局设计）_

- [x] 3.4 渲染时间轴组件

  - 在现有内容区域前添加 `<TimelineAxis>` 组件
  - 传递正确的 props（posts 和 timelineData）
  - 确保时间轴的 z-index 层级正确
  - _需求: 需求 1（时间线布局设计）_

- [x] 3.5 调整现有内容区域

  - 为现有的 `<section>` 添加响应式的左边距
  - 保持所有现有的动画和交互效果不变
  - 确保 BentoGrid、PostCard、MagneticHover、BreathingAnimation 完全不变
  - _需求: 需求 3（文章卡片展示）_

- [x] 4. 实现性能优化功能

  - 实现虚拟化渲染和懒加载，确保大量文章时的性能表现
  - _需求: 需求 4（性能优化功能）_

- [x] 4.1 实现节点虚拟化渲染

  - 在 TimelineAxis 中实现节点数量限制
  - 根据设备类型设置不同的最大节点数（移动端 30、平板 40、桌面 50）
  - 使用 `useMemo` 优化可见节点的计算
  - _需求: 需求 4（性能优化功能）_

- [x] 4.2 优化动画性能

  - 限制动画延迟的最大值，避免用户等待过长
  - 使用合理的动画间隔（0.03 秒）和上限（0.5 秒）
  - 在移动端使用较小的缩放比例
  - _需求: 需求 4（性能优化功能）_

- [x] 4.3 添加省略指示器

  - 当文章数量超过可见节点数时显示 "+X more" 提示
  - 使用合适的样式和位置显示
  - _需求: 需求 4（性能优化功能）_

- [x] 4.4 集成现有 Loading 组件

  - 在数据加载时显示现有的 Loading 组件
  - 确保加载状态的用户体验一致性
  - _需求: 需求 4（性能优化功能）_

- [x] 5. 实现搜索和导航功能

  - 集成时间搜索功能，保持现有的回到顶部功能
  - _需求: 需求 5（导航和搜索功能）_

- [x] 5.1 保持现有回到顶部功能

  - 确保现有的猫咪回到顶部图标功能完全不变
  - 验证 `layoutId='cat-emoji'` 动画效果正常
  - 确保在时间轴存在时的层级关系正确
  - _需求: 需求 5（导航和搜索功能）_

- [x] 5.2 预留时间搜索接口

  - 在 TimelineAxis 组件中预留时间跳转的接口
  - 为未来的时间搜索功能做好准备
  - 添加必要的 props 和回调函数定义
  - _需求: 需求 5（导航和搜索功能）_

- [x] 6. 开发经验记录

  - 将开发过程中的重要经验和解决方案记录到 Learn.md
  - _需求: 需求 6（开发经验记录）_

- [x] 6.1 记录时间线数据处理经验

  - 将边界情况处理的经验记录到 `posts/Learn.md`
  - 记录时间计算和位置映射的技术要点
  - 总结缓存策略的实现和优化效果
  - _需求: 需求 6（开发经验记录）_

- [x] 6.2 记录组件集成经验

  - 记录最小破坏性集成的实践经验
  - 总结响应式设计的实现要点
  - 记录动画性能优化的具体方案
  - _需求: 需求 6（开发经验记录）_

- [x] 6.3 记录性能优化经验

  - 记录虚拟化渲染的实现细节
  - 总结缓存策略的效果和注意事项
  - 记录移动端优化的具体措施
  - _需求: 需求 6（开发经验记录）_

## 实施顺序

**阶段一：数据基础**（任务 1）

- 先实现数据处理函数，为组件提供数据支持
- 确保边界情况处理和缓存机制正确

**阶段二：组件实现**（任务 2）

- 实现时间轴组件的核心功能
- 确保响应式设计和动画效果

**阶段三：页面集成**（任务 3）

- 将时间轴集成到现有博客页面
- 保持所有现有功能不变

**阶段四：性能优化**（任务 4）

- 实现虚拟化和性能优化功能
- 确保大量数据时的流畅体验

**阶段五：功能完善**（任务 5）

- 完善导航功能，预留扩展接口

**阶段六：经验总结**（任务 6）

- 记录开发过程中的重要经验

## 验收标准

- ✅ 所有现有组件（PostCard、BentoGrid、MagneticHover、BreathingAnimation）完全不变
- ✅ 时间轴正确显示，左侧固定，右侧内容滚动
- ✅ 颜色系统按年份分配，同年份相近色彩，同一天颜色一致
- ✅ 响应式设计在移动端、平板、桌面都正常工作
- ✅ 性能优化生效，大量文章时渲染流畅
- ✅ 所有现有动画和交互效果完全保留
- ✅ 开发经验完整记录到 Learn.md 文档

## 技术约束

- **严格复用现有组件**：不修改 PostCard、Badge、Loading、MagneticHover、BreathingAnimation 等
- **最小化新增代码**：优先通过组合现有组件实现新功能
- **保持现有 API**：不修改现有组件的 props 接口和使用方式
- **样式系统一致**：优先使用 Tailwind CSS 类，最小化自定义 CSS
- **渐进式实现**：每个阶段都不破坏现有功能
- **性能优先**：确保时间轴不影响现有页面的性能表现
